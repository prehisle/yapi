# Xychatai Upstream Integration

This document captures the manual configuration performed through the admin UI to route selected traffic to the `xychatai` upstream.

## Entities

- **User**: `zdy`
- **API Key**: generated by the gateway (`yapi_c33f67d5_38e3183909ef46b4080bfd23ad2af226c0b93510`)
- **Upstream Credential**
  - Service / Provider: `xychatai`
  - Name / Label: `primary`
  - API Key: `sk-TGm68VfrwNhR8XJEg4SC0CmIgwYCieth`
  - Endpoint: `https://new.xychatai.com/codex/v1`
- **Binding**: API key above bound to the upstream credential above.

## Rule

| Field | Value |
| --- | --- |
| ID | `route_zdy_xychatai` |
| Priority | `10` |
| Enabled | Yes |
| Matcher | `path_prefix: /v1`, `require_binding: true`, `api_key_prefixes: ["c33f67d5"]` |
| Actions | `set_target_url: https://new.xychatai.com/codex/v1` |

## Validation

Temporary change: the upstream endpoint was switched to `https://httpbin.org/anything` to observe the proxied request. A POST request issued to `http://127.0.0.1:9110/v1` with header `Authorization: Bearer yapi_c33f67d5_38e3183909ef46b4080bfd23ad2af226c0b93510` confirmed:

- The rule matched and forwarded the request.
- The upstream `Authorization` header was rewritten to `Bearer sk-TGm68VfrwNhR8XJEg4SC0CmIgwYCieth`.
- YAPI injected `X-Upstream-*` headers and `X-YAPI-User-ID`.

The upstream endpoint was then restored to `https://new.xychatai.com/codex/v1`.

