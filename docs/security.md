# 安全评估记录

本文档用于跟踪仓库中引入的新依赖与关键安全决策，评估潜在风险并记录缓解措施。

## 2025-10-31：JSON 改写能力依赖

- **依赖名称**：`github.com/tidwall/sjson`（间接依赖 `gjson`、`pretty`、`match`）
- **用途**：在代理阶段对 JSON 请求体执行字段覆盖、数组索引更新与删除操作，满足规则动作“override_json”“remove_json”的实现需求。
- **风险评估**：
  - 仅在代理后端进程内运行，不执行脚本或动态代码，主要风险为非预期的 JSON 处理缺陷。
  - 库作者 Tidwall 社区活跃，版本稳定（v1.2.5），广泛用于生产项目。
  - JSON 改写属于用户可配置功能，若配置错误可能导致请求体被错误修改。
- **缓解措施**：
  - 仅在 `Content-Type` 为 `application/json` 时启用改写，若解析失败会返回错误并附带诊断头 `X-YAPI-Body-Rewrite-Error`。
  - 通过结构化日志 (`slog`) 记录失败原因与请求 ID，便于审计与回滚规则。
  - 建议在后续版本引入集成测试覆盖关键 API 供应商的典型请求体，避免改写逻辑回归。
